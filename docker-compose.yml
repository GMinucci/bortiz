version: '3.3'

volumes:
  postgres_data: {}
  postgres_backup: {}

networks:
  postgres_net: {}

services:
  postgres:
    build: dockerfiles/postgres/
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - postgres_backup:/backups
    env_file: .env
    networks:
      - postgres_net

  web:
    build:
      context: ./
      dockerfile: ./dockerfiles/web/Dockerfile
    env_file: .env
    entrypoint: ["/entrypoint.sh"]
    command: ['gunicorn', '-c', 'gunicorn.py', 'wsgi:application']
    depends_on:
      - postgres
    volumes:
      - .:/app
    networks:
      - postgres_net
    expose:
      - "80"
